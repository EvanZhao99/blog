# CDN与DNS相关知识

## temp
1. DNS: 域名系统（Domain Name System）。本质上是一个分布式数据库，将域名与ip做一一对应。

## DNS查询过程
> 以`www.example.com`为例
1. 检测浏览器缓存
2. 检测本地缓存，如`hosts`文件
3. 检测路由器缓存
4. 网络运营商的服务器查询
5. 根域名服务器查询
   1. 根服务器会返回顶级域名服务器(.com .cn)的地址，本例返回`.com`的地址
   2. 顶级域名服务器会返回次级域名服务器的地址，本例返回`.example`的地址
   3. 次级域名服务器会根据域名返回目标ip，本例返回`www.example.com`的地址

## DNS 安全问题
1. DNS攻击：通过大量的请求查询导致服务器瘫痪
2. DNS劫持：修改返回结果，导致网站不能访问或者访问冒牌网站。


## 什么是CDN？
CDN的全称是 Content Delivery Network, 即内容分发网络。它能够实时地根据网络流量和各节点的连接、负载均衡以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点。  

典型的CDN系统分为三部分：
- 分发服务系统
- 负载均衡系统
- 运营管理系统

### CND过程
1. 用户输入URL之后，经过本地的DNS解析，最终会将域名的解析权交给`CNAME`指向的CDN专用的DNS服务器。
2. 专用的DNS服务器将CDN的全局负载均衡设备ip地址返回给用户。
3. 用户向CDN的全局负载均衡设备发起请求
4. 全局的负载均衡设备根据用户的IP、请求内容URL，选择一台用户所属区域的负载均衡设备
5. 区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务。选择的依据：与用户的距离、用户请求的信息、各个服务器当前的负载情况等。
6. 全局的负载均衡会把具体提供服务的的服务器IP返回给用户。
7. 用户向缓存服务器发起请求，缓存服务器将相应的内容返回给用户。如果这台缓存服务器没有用户想要的内容，会想它上一级的服务器请求内容，直至追溯到源服务器，并将内容同步到本地。

### CDN的有点
- 本地Cache加速，加快访问速度。
- 镜像服务，消除运营商之间的差异
- 带宽优化
- 集群抗攻击
- 解约成本